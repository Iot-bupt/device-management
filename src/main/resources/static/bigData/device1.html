<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>大数据平台-数据管理</title>
    <link href="../bigdatamanagement/css/bootstrap.css" rel="stylesheet">
    <link href="../bigdatamanagement/css/bootstrap-table.css" rel="stylesheet">
    <link href="../bigdatamanagement/css/bootstrap-select.css" rel="stylesheet">
    <style>
        .abc:hover {
            color: black !important;
        }
        .abc0:hover{
            background-color: #337ab7 !important;
        }

    </style>
</head>
<body style="padding-top: 50px;height: 100%">

<nav class="navbar navbar-fixed-top" style="background-color: #337ab7">

        <div class="navbar-header" style="margin-left: 10px">
            <a class="navbar-brand" href="#" style="color: white">大数据平台</a>
        </div>
        <div class="navbar-collapse">
            <!--<ul class="nav navbar-nav">
                <li><a href="/userformPage.do"  class="abc0"style="color: #faf2cc">用户管理</a></li>
                <li class="dropdown">
                    <a href="#" class="abc" style="color: white" data-toggle="dropdown">我的网盘<span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="/uploadPage.do">springmvc</a></li>
                        <li><a href="#">springsecurity</a></li>
                        <li><a href="#">spring</a></li>
                        <li class="divider"></li>
                        <li class="dropdown-header">DAO</li>
                        <li><a href="#">mybatis</a></li>
                        <li><a href="#">hibenate</a></li>
                    </ul>
                </li>
            </ul>-->
            <ul class="navbar-right navbar-form">
                <!--<div class="form-group">
                    <input type="text" placeholder="Email" class="form-control">
                </div>-->
               <a href="/home?TENANT_ADMIN&2&1"><button id="logout" type="submit" class="btn btn-primary" style="margin-right: 40px">返回上一级</button></a>
            </ul>
        </div><!--/.nav-collapse -->

</nav>

<div class="row" style="height: 100%">
    <div class="col-md-2" style="box-shadow: 1px 1px 3px #e5e5e5;height: 1030px;width: 13%">
        <ul id="main-nav" class="nav nav-stacked" style="">
            <li>
                <a href="#" onclick="dashboard()">
                    <i class="glyphicon glyphicon-home">&nbsp;</i>
                    Dashboard
                </a>
            </li>
            <li class="active" style="background-color: #eeeeee">
                <a href="device1.html">
                    <i class="glyphicon glyphicon-th-large">&nbsp;</i>
                    数据管理
                </a>
            </li>
            <li>
                <a href="../bigdatamanagement/sql.html">
                    <i class="glyphicon glyphicon-search">&nbsp;</i>
                    SQL查询
                </a>
            </li>
            <li>
                <a href="#systemSetting" class="nav-header collapsed" data-toggle="collapse">
                    <i class="glyphicon glyphicon-stats">&nbsp;</i>
                    数据分析
                    <!--<span class="pull-right glyphicon glyphicon-chevron-down"></span>-->
                    <span class="label label-warning pull-right">2</span>
                </a>
                <ul id="systemSetting" class="nav nav-list collapse secondmenu" style="height: 0px;border-bottom: 1px silver dotted">
                    <li><a href="ocean.html"><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</i>- 整体分析</a></li>
                    <li><a href="statistics1.html"><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</i>- 按类分析</a></li>
                    <!--<li><a href="#"><i class="glyphicon glyphicon-edit">&nbsp;</i> 修改密码</a></li>
                    <li><a href="#"><i class="glyphicon glyphicon-eye-open">&nbsp;</i> 日志查看</a></li>-->
                </ul>
            </li>
            <li>
                <a href="../bigdatamanagement/etl.html">
                    <i class="glyphicon glyphicon-cog">&nbsp;</i>
                    数据ETL
                </a>
            </li>
            <li>
                <a href="#systemSetting1" class="nav-header collapsed" data-toggle="collapse">
                    <i class="glyphicon glyphicon-eye-open">&nbsp;</i>
                    数据预测
                    <!--<span class="pull-right glyphicon glyphicon-chevron-down"></span>-->
                    <span class="label label-warning pull-right">2</span>
                </a>
                <ul id="systemSetting1" class="nav nav-list collapse secondmenu" style="height: 0px;border-bottom: 1px silver dotted">
                    <li><a href="../bigdatamanagement/predict.html"><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</i>- 任务管理</a></li>
                    <li><a href="../bigdatamanagement/model.html"><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</i>- 模型管理</a></li>
                    <li><a href="#" onclick="result1()"><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</i>- 预测结果</a></li>
                </ul>
            </li>
            <li>
                <a href="../bigdatamanagement/datadig.html">
                    <i class="glyphicon glyphicon-leaf">&nbsp;</i>
                    数据挖掘
                </a>
            </li>
            <li>
                <a onclick="online()">
                    <i class="glyphicon glyphicon-cloud">&nbsp;</i>
                    线上开发
                </a>
            </li>
        </ul>
    </div>

    <div class="col-md-10">
        <div class="container"  style="padding: 30px 15px">

            <!-- 按钮触发模态框 -->
            <p>
                <input type="text" id="input1" class="form-control" placeholder="文件路径" value="/data" autofocus style="width: 91%;display: inline">
                <button class="btn btn-sm btn-primary" id="button1" style="margin-left: 2%">查询文件</button>
            </p>
            <!--&lt;!&ndash; 模态框（Modal） &ndash;&gt;
            <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                            <h4 class="modal-title" id="myModalLabel">添加用户</h4>
                        </div>
                        <div class="modal-body">
                            <h6>请输入用户信息:</h6><br>
                            <input id="input1" type="text" class="form-control" required placeholder="id"><br>
                            <input id="input2" type="text" class="form-control" required placeholder="用户名"><br>
                            <input id="input3" type="text" class="form-control" required placeholder="密码"><br>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                            <button id="modalbutton1" type="button" class="btn btn-primary">提交更改</button>
                        </div>
                    </div>&lt;!&ndash; /.modal-content &ndash;&gt;
                </div>&lt;!&ndash; /.modal &ndash;&gt;
            </div>

            &lt;!&ndash; 模态框（Modal） &ndash;&gt;
            <div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel2" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                            <h4 class="modal-title" id="myModalLabel2">修改用户</h4>
                        </div>
                        <div class="modal-body">
                            <h6>请输入修改信息:</h6><br>
                            <input id="input4" type="text" class="form-control" required placeholder="id"><br>
                            <input id="input5" type="text" class="form-control" required placeholder="用户名"><br>
                            <input id="input6" type="text" class="form-control" required placeholder="密码"><br>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                            <button id="modalbutton2" type="button" class="btn btn-primary">提交更改</button>
                        </div>
                    </div>&lt;!&ndash; /.modal-content &ndash;&gt;
                </div>&lt;!&ndash; /.modal &ndash;&gt;
            </div>-->

            <!--<select id="select1" class="selectpicker" data-live-search="true" data-live-search-placeholder="搜索" title="大魔王">
                <optgroup label="filter1">
            　　　　<option>option1</option>
            　　　　<option>option2</option>
            　　　　<option>option3</option>
            　　　　<option>option4</option>
            　　</optgroup>
            　　<optgroup label="filter2">
            　　　　<option>option1</option>
            　　　　<option>option2</option>
            　　　　<option>option3</option>
            　　　　<option>option4</option>
            　　</optgroup>
            </select>-->
            <!--<div style="padding: 40px 15px;text-align: center;">
                <h1>Bootstrap starter template</h1>
                <p class="lead">Use this document as a way to quickly start any new project.<br> All you get is this text and a mostly barebones HTML document.</p>
            </div>-->

            <!--<img src="image/test.jpg" class="img-thumbnail">-->

            <div class="panel panel-primary" style="margin-top: 2%">
                <div class="panel-heading" style="text-align: center">
                    <h3 class="panel-title">数据管理</h3>
                </div>
                <div id="divtable" class="panel-body" style="text-align: center">
                    <table id="realTime_Table">
                        <thead id="thead"></thead>
                        <tbody id="tbody"></tbody>
                    </table>
                </div>
            </div>

            <div id="wait1" class="progress" style="margin-top: 15%;width: 60%;margin-left: 15%;display: none">
                <div id="wait2" class="progress-bar progress-bar-striped" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%"></div>
            </div>

            <!--<table class="table table-bordered">
                <thead>
                <tr class="label-info" style="color: white;background-color: #222;text-align: center">
                    <th style="text-align: center">用户名</th>
                    <th style="text-align: center">密  码</th>
                    <th style="text-align: center">操  作</th>
                </tr>
                </thead>

                <tbody>
                <tr>
                    <td>Tom</td>
                    <td>123456</td>
                    <td>delete</td>
                </tr>
                <tr>
                    <td>Kate</td>
                    <td>12345678</td>
                    <td>delete</td>
                </tr>
                <tr>
                    <td>Peter</td>
                    <td>1234</td>
                    <td>delete</td>
                </tr>
                </tbody>
            </table>-->

        </div>
    </div>
</div>

<script src="../bigdatamanagement/js/jquery-3.3.1.js"></script>
<script src="../bigdatamanagement/js/bootstrap.js"></script>
<script src="../bigdatamanagement/js/bootstrap-table.js"></script>
<script src="../bigdatamanagement/js/bootstrap-table-zh-CN.js"></script>
<script src="../bigdatamanagement/js/bootstrap-select.js"></script>
<script src="../bigdatamanagement/js/common.js"></script>
<script type="text/javascript">

    $(function () {
        waiting();
        getajax("/data");
    });

    $("#button1").click(
        function () {
            var path = $("#input1").val();
            getajax(path);
        }
    );

    function getajax(path) {
        $(document).off("click",".deleteButton");
        $("#divtable").empty();
        $("#wait1").css("display","block");
        waiting();
        $.get("http://39.104.186.210:8092/api/hdfs/getFiles?path="+path+"&owner=spark&group=supergroup",function (data) {

            $("#divtable").append("<table id=\"realTime_Table\">\n" +
                "                        <thead id=\"thead\"></thead>\n" +
                "                        <tbody id=\"tbody\"></tbody>\n" +
                "                    </table>");

            $tr1 = $(" <tr>\n" +
                "                            <th style=\"text-align: center\">Permission</th>\n" +
                "                            <th style=\"text-align: center\">Count</th>\n" +
                "                            <th style=\"text-align: center\">Owner</th>\n" +
                "                            <th style=\"text-align: center\">Group</th>\n" +
                "                            <th style=\"text-align: center\">Size</th>\n" +
                "                            <th data-field=\"time\" data-sortable=\"true\" style=\"text-align: center\">Last Modified</th>\n" +
                "                            <th style=\"text-align: center\">Type</th>\n" +
                "                            <th data-field=\"path\" data-sortable=\"true\" style=\"text-align: center\">Path</th>\n" +
                "                            <th style=\"text-align: center\">操作</th>\n" +
                "                        </tr>");
            $("#thead").append($tr1);

            for (var i=0; i<data.length; i++){
                $tr = $("<tr></tr>");
                $td1 = $("<td>"+data[i].permission+"</td>");
                $td2 = $("<td>"+data[i].childrenNum+"</td>");
                $td3 = $("<td>"+data[i].owner+"</td>");
                $td4 = $("<td>"+data[i].group+"</td>");
                $td5 = $("<td>"+data[i].blockSize+"</td>");
                $td6 = $("<td>"+formatDate(new Date(data[i].modificationTime))+"</td>");
                $td7 = $("<td>"+data[i].type+"</td>");
                $td8 = $("<td>"+data[i].path+"</td>");
                if (path == "/"){
                    $td9 = $("<td><button class='btn-xs btn-default deleteButton' type='button' disabled='disabled'>删除</button></td>");
                }else {
                    $td9 = $("<td><button class='btn-xs btn-warning deleteButton' type='button'>删除</button></td>");
                }
                $tr.append($td1);
                $tr.append($td2);
                $tr.append($td3);
                $tr.append($td4);
                $tr.append($td5);
                $tr.append($td6);
                $tr.append($td7);
                $tr.append($td8);
                $tr.append($td9);
                $("#tbody").append($tr);
            }
            $("#wait1").css("display","none");
            $("#realTime_Table").bootstrapTable({
                search: true,
                pagination: true,
                pageSize: 10,
                pageList: [5, 10, 15, 20, 50, 100],
                locale: "zh-CN",
                striped: true,
                showColumns: true,
                sortable: true,
                sortName: "time"
            });

            $(document).on("click",".deleteButton",function () {
                $.get("http://39.104.186.210:8092/api/hdfs/deleteFiles?path=" + $(this).parent().parent().find("td").eq(7).html(), function (data) {
                    if (data.code == "200"){
                        window.alert("删除成功！");
                        window.location.href = "device1.html";
                    }else {
                        window.alert("删除失败！");
                    }
                });
            })
        });
    }

    function waiting() {
        $("#wait2").css("width","0%");
        setTimeout(function () {
            $("#wait2").css("width","20%");
        },1000);
        setTimeout(function () {
            $("#wait2").css("width","50%");
        },2000);
        setTimeout(function () {
            $("#wait2").css("width","80%");
        },3000);
        setTimeout(function () {
            $("#wait2").css("width","100%");
        },4000);
    }

    function formatDate(now) {
        var year=now.getFullYear();
        var month=now.getMonth()+1;
        var date=now.getDate();
        var hour=now.getHours();
        var minute=now.getMinutes();
        var second=now.getSeconds();
        return year+"-"+month+"-"+date+" "+hour+":"+minute+":"+second;
    }

   /*$(function() {
            $.post("/getAllUser.do",function (data) {
                var mes = eval("(" + data + ")");
                for (var i = 0; i < mes.length; i++) {
                    $tr = $("<tr></tr>");
                    $td1 = $("<td data-checkbox='true'></td>");
                    $td2 = $("<td>" + mes[i].id + "</td>");
                    $td3 = $("<td>" + mes[i].userName + "</td>");
                    $td4 = $("<td>" + mes[i].password + "</td>");
                    $td5 = $("<td><button class='btn-xs btn-warning deleteButton' type='button'>删除</button></td>");
                    $tr.append($td1);
                    $tr.append($td2);
                    $tr.append($td3);
                    $tr.append($td4);
                    $tr.append($td5);
                    $("#tbody").append($tr);
                }
                $("#realTime_Table").bootstrapTable({
                    search: true,
                    pagination: true,
                    pageSize: 10,
                    pageList: [5, 10, 15, 20, 50, 100],
                    locale: "zh-CN",
                    striped: true,
                    showColumns: true,
                    sortable: true,
                    sortName: "id"
                });

                //jquery的on可以为未来的html标签绑定事件
                $(document).on("click",".deleteButton",function () {
                    $.post("/"+$(this).parent().parent().children().eq(1).html()+"/"+"deleteUser.do?sss=ssss",{asd:"123123123",aaa:"hahaha"},function (flag) {
                        if(flag == "true"){
                            window.alert("删除成功！");
                            window.location.href = "/userformPage.do";
                        }else {
                            window.alert("删除失败！");
                        }

                    });
                })
            })
        }
    );*/

</script>
</body>
</html>