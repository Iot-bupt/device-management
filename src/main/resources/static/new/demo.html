<!doctype html>
<html lang="en">

<head>
	<title>数据分析平台</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
	<!-- VENDOR CSS -->
	<link rel="stylesheet" href="assets/vendor/bootstrap/css/bootstrap.min.css">

	<link rel="stylesheet" href="assets/vendor/font-awesome/css/font-awesome.min.css">
	<link rel="stylesheet" href="assets/vendor/linearicons/style.css">
	<link rel="stylesheet" href="assets/vendor/chartist/css/chartist-custom.css">
	<!-- MAIN CSS -->
	<link rel="stylesheet" href="assets/css/main.css">
	<!-- FOR DEMO PURPOSES ONLY. You should remove this in your project -->
	<link rel="stylesheet" href="assets/css/demo.css">
	<!-- GOOGLE FONTS -->
	<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700" rel="stylesheet">
	<!-- ICONS -->
	<link rel="apple-touch-icon" sizes="76x76" href="assets/img/apple-icon.png">
	<link rel="icon" type="image/png" sizes="96x96" href="assets/img/favicon.png">

	<script src="assets/vendor/jquery/jquery.min.js"></script>
	<script src="assets/vendor/bootstrap/js/bootstrap.min.js"></script>
	<script src="assets/vendor/jquery-slimscroll/jquery.slimscroll.min.js"></script>
	<script src="assets/vendor/chartist/js/chartist.min.js"></script>
	<script src="assets/scripts/klorofil-common.js"></script>
	<script src="style.js"></script>
	<script src="echarts.js"></script>

	<!--<script src="echarts.js"></script>-->
	<!--<script src="history.js"></script>-->
<!--
	<script src="submitTime.js"></script>
-->

	<script src="getDevice.js"></script>

</head>

<body>
	<!-- WRAPPER -->
	<div id="wrapper">
		<!-- NAVBAR -->
		<nav class="navbar navbar-default navbar-fixed-top">
			<div class="brand">
				<a href="http://39.104.84.131:8081/homepages.html" style="font-size: 20px;font-weight: bold;">数据分析平台</a>
			</div>
			<div class="container-fluid">
				<div class="navbar-btn">
					<button type="button" class="btn-toggle-fullwidth"><i class="lnr lnr-arrow-left-circle"></i></button>
				</div>
				<form class="navbar-form navbar-left">
					<!-- <div class="input-group">
						<input type="text" value="" class="form-control" placeholder="Search dashboard...">
						<span class="input-group-btn"><button type="button" class="btn btn-primary">Go</button></span>
					</div> -->
					<div >
						<select id="device">
							<option value="">请选择设备</option>
						</select>
					<!--	<input type="text" id="deviceInput">
						<ul class="deviceUl">

						</ul>-->
					</div>


				</form>
				<div class="navbar-btn navbar-btn-right">
					<a class="btn btn-success update-pro" href="#downloads/klorofil-pro-bootstrap-admin-dashboard-template/?utm_source=klorofil&utm_medium=template&utm_campaign=KlorofilPro" title="Upgrade to Pro" target="_blank"><i class="fa fa-rocket"></i> <span>UPGRADE TO PRO</span></a>
				</div>
				<div id="navbar-menu">
					<ul class="nav navbar-nav navbar-right">
						<!--<li class="dropdown">
							<a href="#" class="dropdown-toggle icon-menu" data-toggle="dropdown">
								<i class="lnr lnr-alarm"></i>
								<span class="badge bg-danger">5</span>
							</a>
							 <ul class="dropdown-menu notifications"> 
								<li><a href="#" class="notification-item"><span class="dot bg-warning"></span>System space is almost full</a></li>
								<li><a href="#" class="notification-item"><span class="dot bg-danger"></span>You have 9 unfinished tasks</a></li>
								<li><a href="#" class="notification-item"><span class="dot bg-success"></span>Monthly report is available</a></li>
								<li><a href="#" class="notification-item"><span class="dot bg-warning"></span>Weekly meeting in 1 hour</a></li>
								<li><a href="#" class="notification-item"><span class="dot bg-success"></span>Your request has been approved</a></li>
								<li><a href="#" class="more">See all notifications</a></li>
							</ul>
						</li>-->
						<!-- <li class="dropdown"> 
							<a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="lnr lnr-question-circle"></i> <span>Help</span> <i class="icon-submenu lnr lnr-chevron-down"></i></a>
							<ul class="dropdown-menu">
								<li><a href="#">Basic Use</a></li>
								<li><a href="#">Working With Data</a></li>
								<li><a href="#">Security</a></li>
								<li><a href="#">Troubleshooting</a></li>
							</ul>
						</li>-->
						<!-- <li class="dropdown"> 
							<a href="#" class="dropdown-toggle" data-toggle="dropdown"><img src="assets/img/user.png" class="img-circle" alt="Avatar"> <span>Samuel</span> <i class="icon-submenu lnr lnr-chevron-down"></i></a>
							<ul class="dropdown-menu">
								<li><a href="#"><i class="lnr lnr-user"></i> <span>My Profile</span></a></li>
								<li><a href="#"><i class="lnr lnr-envelope"></i> <span>Message</span></a></li>
								<li><a href="#"><i class="lnr lnr-cog"></i> <span>Settings</span></a></li>
								<li><a href="#"><i class="lnr lnr-exit"></i> <span>Logout</span></a></li>
							</ul>
						</li>-->
						<!-- <li>
							<a class="update-pro" href="#downloads/klorofil-pro-bootstrap-admin-dashboard-template/?utm_source=klorofil&utm_medium=template&utm_campaign=KlorofilPro" title="Upgrade to Pro" target="_blank"><i class="fa fa-rocket"></i> <span>UPGRADE TO PRO</span></a>
						</li> -->
					</ul>
				</div>
			</div>
		</nav>
		<!-- END NAVBAR -->
		<!-- LEFT SIDEBAR -->
		 <div id="sidebar-nav" class="sidebar"> 
			<div class="sidebar-scroll">
				<nav>
					<ul class="nav">
						<!-- <li><a href="index.html" class=""><i class="lnr lnr-home"></i> <span>Dashboard</span></a></li> -->
						<!-- <li><a href="elements.html" class=""><i class="lnr lnr-code"></i> <span>Elements</span></a></li> -->
						<!-- <li><a href="charts.html" class="active"><i class="lnr lnr-chart-bars"></i> <span>Charts</span></a></li> -->
						<!-- <li><a href="panels.html" class=""><i class="lnr lnr-cog"></i> <span>Panels</span></a></li> -->
						<!-- <li><a href="notifications.html" class=""><i class="lnr lnr-alarm"></i> <span>Notifications</span></a></li> -->
						<li>
							<a href="#subPages" data-toggle="collapse" class="collapsed"><i class="lnr lnr-file-empty"></i> <span>Charts</span> <i class="icon-submenu lnr lnr-chevron-left"></i></a>
							<div id="subPages" class="collapse ">
								<ul class="nav">
									<li onclick="realtime()"><a  style="cursor: pointer" >real-time data</a></li>
									<li onclick="history()"><a  style="cursor: pointer"  >history data</a>

									</li>
<!--
									<li onclick="submitTim()">11111</li>
-->
									<!--cursor属性：定义了鼠标指针放在一个元素边界范围内时所用的光标形状-->
									<!-- <li><a href="page-lockscreen.html" class="">Lockscreen</a></li> -->
								</ul>
							</div>
						</li>
						<!-- <li><a href="tables.html" class=""><i class="lnr lnr-dice"></i> <span>Tables</span></a></li> -->
						<!-- <li><a href="typography.html" class=""><i class="lnr lnr-text-format"></i> <span>Typography</span></a></li> -->
						<!-- <li><a href="icons.html" class=""><i class="lnr lnr-linearicons"></i> <span>Icons</span></a></li> -->
					</ul>
				</nav>
			</div>
		</div>
		<!-- END LEFT SIDEBAR -->
		<!-- MAIN -->
		<div class="main">
			<!-- MAIN CONTENT -->

			<div class="main-content">
				<div id="container-fluid" class="container-fluid">
					<!-- <h3 class="page-title" style="color:rgb(153,220,220);display: inline-block;">数据分析平台</h3> -->
                    <!-- <h4 class="page-title" style="margin-left:600px;display: inline-block;">温湿4</h4> -->
					<div class="row">

                        <div class="col-md-12 col-md-offset-2" id="choose1">

							<form class="navbar-form navbar-left" role="search">
								<div class="form-group" style="width: 100%">
									startTime：<input type="date" class="form-control" id="start_date">
									endTime：<input type="date" class="form-control" id="end_date">

								</div>

							</form>

							<input type="button" class="btn btn-default" id="submitTime" onclick="submitTime()"  style="position: absolute;top: 23px;" value="submit">

							<!--<div class="panel">
                            <div class="panel-heading">
                                    <h3 class="panel-title">平均值</h3>
                                </div>
                                <div class="panel-body">
                                    <div id="demo-line-chart" class="ct-chart"></div>
                                </div>
                            </div>-->
						</div>
						<div class="col-md-6">
                            <!--<div class="panel">
                                <div class="panel-heading">
                                    <h3 class="panel-title">方差</h3>
                                </div>
                                <div class="panel-body">
                                    <div id="demo-bar-chart" class="ct-chart"></div>
                                </div>
                            </div>
                        </div>-->
                    </div>
                    <!--<div class="row">
                        <div class="col-md-6">
                            <div class="panel">
                                <div class="panel-heading">
                                    <h3 class="panel-title">Area Chart</h3>
                                </div>
                                <div class="panel-body">
                                    <div id="demo-area-chart" class="ct-chart"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="panel">
                                <div class="panel-heading">
                                    <h3 class="panel-title">Multiple Chart</h3>
                                </div>
                                <div class="panel-body">
                                    <div id="multiple-chart" class="ct-chart"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div> -->
			<!-- END MAIN CONTENT -->
		</div>
		<!-- END MAIN -->
		<!--<div class="clearfix"></div>
		 <footer>
			<div class="container-fluid">
				<p class="copyright">Copyright &copy; 2017.Company name All rights reserved.<a target="_blank" href="http://sc.chinaz.com/moban/">&#x7F51;&#x9875;&#x6A21;&#x677F;</a></p>
			</div>
		</footer> 
	</div>-->
	<!-- END WRAPPER -->
	<!-- Javascript -->
	<style type="text/css">
					#main1{display: none;}
					#choose1{display: none;}
	</style>
			<!-- 为ECharts准备一个具备大小（宽高）的Dom -->
			<div id="main" style="height:400px"></div>
			<!--ECharts单文件引入-->
					<script src="realtime.js"></script>


            <!-- 为ECharts准备一个具备大小（宽高）的Dom -->
            <div id="main1" style="height:400px;width: 1000px"></div>

				</div>
			</div>
		</div>
	</div>
<!--
<input onclick="submitTim()" value="1111111111111">
-->
</body>
<!--submitTime.js-->
<script>
    var nameuse=[];
	var device_ID;
    var time1;
    var time2;



    var xTemp = [];

    var temp1=[];
    var ydata=[];
    function submitTime() {
         // 表单提交数据
         // alert("1")
         var sTime = document.getElementById("start_date").value;
         var eTime = document.getElementById("end_date").value;
         /*alert(sTime);
         alert(eTime);*/
         var str1 = sTime.replace(/-/g, '/'); // 将-替换成/，因为下面这个构造函数只支持/分隔的日期字符串
         var str2 = eTime.replace(/-/g, '/');
         var date1 = new Date(str1);//将字符串类型的时间转换为日期对象
         var date2 = new Date(str2);
         /*alert(str1);
         alert(str2);*/
         time1 = date1.getTime();//将日期对象转换为时间戳
         time2 = date2.getTime();
        /* alert(time1);
         alert(time2);*/
         if (time1 > time2)
             alert("Wrong time.")
         device_ID = document.getElementById("device").value;//获取设备id
/*
         alert(device_ID);
*/
     }
    function formatDate(now) {

        var year = now.getFullYear();
        var month = now.getMonth() + 1;
        var date = now.getDate();
        var hour = now.getHours();
        var minute = now.getMinutes();
        var second = now.getSeconds();
        return year + "-" + month + "-" + date + " " + hour + ":" + minute + ":" + second;
    }
    $("#submitTime").on("click",function () {
        console.log(device_ID);
        console.log(time2);
        console.log(time1);
        /*取有几个属性*/
        //var para = [];

        $.ajax({
            url: "/api/data/getKeyData/" + deviceId,
            type: "GET",
            dataType: "text",
            success: function (data) {
                var name = data.replace(/\[|]/g, "");
                name = name.replace(/\"/g, "");
                nameuse = name.split(",");
                //chart(nameuse);
                console.log("参数：" + data);
            }
        });

        /*取后台数据*/
        $.ajax({
            url: "/api/data/getHistoricalData/" + device_ID + "/" + time1 + "/" + time2,
            type: "GET",
            /*contentType: "application/json;charset=utf-8",//服务端返回的一段json串给客户端*!/
            //data: JSON.stringify({'time1': time1, 'time2': time2,'device_ID':device_ID}),//使用POST请求时前端传给后端的数据*/
            dataType: "text",//后台交付的数据为字符串形式

            success: function (data) {//success为请求成功后的回调函数
				//var value[];
                console.log(data);
                var temp = JSON.parse(data);//将字符串转为json
                var xArr = [];//先声明一维
                for(var k=0;k<4;k++){        //一维长度为i,i为变量，可以根据实际情况改变
                    xArr[k]=[];    //声明二维，每一个一维数组里面的一个元素都是一个数组
                }//用于存放x轴时间戳
                var yArr = [];//用于存放y轴数据
                for(var k=0;k<4;k++){        //一维长度为i,i为变量，可以根据实际情况改变
                    yArr[k]=[];    //声明二维，每一个一维数组里面的一个元素都是一个数组
                }
                var xFin = [];
                console.log(temp);



				for(var key in temp)
				{
				    for(var j=0;j<nameuse.length;j++)
					{
                        if(key==nameuse[j])
                        {
                            var value= temp[key]
                            for(var i=0;i<value.length;i++)
                            {
                                if (i % 10 == 0)
                                {
                                    xArr[j].push(value[i].ts);
                                    yArr[j].push(value[i].value);
                                }
                            }
                        }
					}
				}

               /* for (var i = 0; i < temp.data.length; i++) {
                    if (i % 10 == 0) {    /!*push()向数组队尾追加一个数据，然后返回新的数组长度*!/
                        console.log(temp.data[i].ts);
                        xArr.push(temp.data[i].ts);
                        yArr.push(temp.data[i].value);
                        /!*console.log(xArr);
                        console.log(yArr);*!/
                    }
                }*/
                console.log(xArr);
				console.log(yArr);
                for (var i = 0; i <= xArr.length; i++) {
                    xTemp[i] = new Date(xArr[0][i]);

                    console.log("xArr" + i + ":" + xArr[i]);
                    console.log("yArr" + i + ":" + yArr[i]);
                    xFin.push(formatDate(xTemp[i]));


                    console.log(xFin[i]);


                }
                console.log(nameuse);
                hsCharts(nameuse,xFin,yArr);
                /*for(var j=1;nameuse[j]!=null;j++)
				{
				    for(var i= 1;i<100;i++)
					{
					    temp1[j]=temp.nameuse[j].i.ts;
					    ydata[j]=temp.nameuse[j].i.value;
					    console.log(temp1[i]);
					}
				}*/
            },
            error: function (msg) {//error为在请求出错时的回调函数
                console.log(msg.message);
            }
        });
    })





    function hsCharts(data,xFin,yArr) {
        require.config({
            paths: {
                echarts: 'http://echarts.baidu.com/build/dist'
            }
        });
// 使用
        require
        (
            [
                'echarts',
                'echarts/chart/line'  // 使用柱状图就加载bar模块，按需加载
            ],
            function (ec)
            {
                // 基于准备好的dom，初始化echarts图表
                var myChart = ec.init(document.getElementById('main1'));
                // 指定图表的配置项和数据
                var option = {

                    tooltip: {
                        trigger: 'axis'
                    },

                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '3%',
                        containLabel: true
                    },
                    toolbox: {
                        feature: {
                            saveAsImage: {}
                        }
                    },
                    xAxis: {
                        type: 'category',
                        boundaryGap: false,
                        data: (function () {
                            var res = [];
                            // var len = 10;
                           for(var i = xFin.length-1; i>=0;i--) {
                                // res.push((Math.random()*10 + 5).toFixed(1) - 0);
                                res.push(xFin[i]);
                            }
                            return res;
                        })()

                    },
                    yAxis: {
                        type: 'value'
                    },
                    series: [


                    ]
                };



                var item = [];
                for (var i = 0; i < data.length; i++) {
                    var things = {
                        name: data[i],
                        type: 'line',
                        data: (function () {
                            var res = [];
                            //var len = 10;

                            for(var j=yArr[i].length-1;j>=0;j--) {
                                // res.push((Math.random()*10 + 5).toFixed(1) - 0);
                                res.push(yArr[i][j]);
                            }
                            return res;
                        })()
                    }
                    item.push(things);
                }




                var legend = {data: data};
                option.legend = legend;
                option.series = item;
                console.log(option);
                myChart.setOption(option);



                /* 一段不知道作用的代码*/
                var lastData = 11;
                var axisData;
                var timeTicket;
                clearInterval(timeTicket);
                timeTicket = setInterval(function (){
                    lastData += Math.random() * ((Math.round(Math.random() * 10) % 2) == 0 ? 1 : -1);
                    lastData = lastData.toFixed(1) - 0;
                    axisData = (new Date()).toLocaleTimeString("ja-JP").replace(/^\D*/,'');

                    // 动态数据接口 addData
                    myChart.addData([

                        [
                            1,
                            // 系列索引

                            //e.data.data[1],
                            lastData, // 新增数据

                            false,    // 新增数据是否从队列头部插入
                            false,    // 是否增加队列长度，false则自定删除原有数据，队头插入删队尾，队尾插入删队头
                            axisData  // 坐标轴标签
                        ]
                    ]);
                }, 2100);
            }
        );
    }
</script>

</html>
